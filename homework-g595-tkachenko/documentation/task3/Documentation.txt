Описание устройства KlabertancOptimizedStorage

База данных представляет из себя объединение двух файлов (“keys.db” и “values.db”). В первом хранятся ключи и смещения значений, соответствующих данным ключам, в файле “values.db”. Имеются два Map’а на чтение и запись, которые ускоряют доступ к недавним ключам. При превышении ими максимально допустимого размера, кэш для чтения очищается, кэш для записи дописывает свое содержимое в “values.db” (и очищается). При чтении ключа мы сначала проверяем его в кэшах, а затем уже на диске. При записи мы сначала кладем ключ в кэш. Мы всегда кладем ключ в кэш смещений с смещением (-1) для работы итератора (затем при дампе мы перепишем эту позицию).